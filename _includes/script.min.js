$(document).ready(function(s){var t,a,c={c:["c","d","e","f","g","a","b"],cs:["cs","ds","f","fs","gs","as","c"],d:["d","e","fs","g","a","b","cs"],ds:["ds","f","g","gs","as","c","d"],e:["e","fs","gs","a","b","cs","ds"],f:["f","g","a","as","c","d","e"],fs:["fs","gs","as","b","cs","ds","f"],g:["g","a","b","c","d","e","fs"],gs:["gs","as","c","cs","ds","f","g"],a:["a","b","cs","d","e","fs","gs"],as:["as","c","d","ds","f","g","a"],b:["b","cs","ds","e","fs","gs","as"]},i=120,n=0,e=0,l=0,o="img/stop.png",r=!1,h=[],d=0,g=s(window).height()/15;maxTracks=5;var p=function(){for(d++;s(".col").length/s(".track").length<16*d;)s(".col").length/s(".track").length%4==1?s(".track").each(function(){s(this).children(".col").last().children().css("border-left","solid 1px black")}):s(".track").each(function(){s(this).children(".col").last().children().css("border-left","solid 1px gray")}),s(".track").each(function(){s(this).children(".col").last().clone(!0).insertAfter(s(this).children(".col").last());var t=s(this).children(".col").last();t.children().removeClass("active"),t.children().css("background-color","gainsboro"),t.children(".black_key").css("background-color","silver")})};p();var u=function(){(g=s(window).height()/15)>90&&(g=90),s(".button").css({height:g+"px",width:g+"px"}),s(".inst_button").css({height:1.5*g+"px",width:1.5*g+"px"}),s("#tempo").css({height:.5*g+"px",width:1.7*g+"px"}),s("#tempo_button").css({height:g+"px",width:3*g+"px"}),s("#tempo").css("font",s(window).height()/30+"px bold Verdana, sans-serif"),k()},k=function(){var t=s(".track").height(),a=t/2-10;t<180&&a<g?s(".trackbutton").css({height:a+"px",width:a+"px"}):s(".trackbutton").css({height:g+"px",width:g+"px"})};u(),s("#tempo").val(i),s(document).keypress(function(t){13==t.which&&s("#tempo_button").trigger("click")}),s(".track").scroll(function(){s(".track").scrollLeft(s(this).scrollLeft())}),s(window).resize(function(){u()}),s("#addmeasure").click(function(){p()}),s("#deletemeasure").click(function(){if(d<2)return!0;for(var t=0;t<16;t++)s(".track").each(function(){s(this).children(".col").last().remove()});d--}),s("#tempo").click(function(){s("#tempo").val("")}),s("#tempo_button").click(function(){if(""==s("#tempo").val())return!0;var t=parseInt(s("#tempo").val());t?i=t:(s("#tempo").css("background-color","#FF5050"),setTimeout(function(){s("#tempo").css("background-color","gray")},500),s("#tempo").val("")),s("#playstop").hasClass("playing")&&(clearInterval(n),n=setInterval(s(this).playCol,3e4/i))}),s(".track_container").on("click",".note",function(){e=s(s(this).get(0).parentNode.parentNode),(h=instruments[e.attr("class").split(" ")[1]]).play(s(this).attr("class").split(" ")[0]),s(this).hasClass("label")||(s(this).hasClass("active")?s(this).hasClass("black_key")?s(this).css("background-color","silver"):s(this).css("background-color","gainsboro"):s(this).css("background-color","#4b86b4"),s(this).toggleClass("active"))}),s("#keychange").click(function(){s("#key_menu").toggle()}),s(".key_choice_cell").click(function(){s("#key_menu").toggle();var t=s(this).attr("class").split(" ")[1];if(s(".note").css("display","inline-block"),"none"==t)return!0;s(".note").each(function(){if((e=s(s(this).get(0).parentNode.parentNode)).hasClass("drums"))return!0;s.inArray(s(this).attr("class").split(" ")[1],c[t])<0&&(s(this).removeClass("active"),s(this).fadeOut("slow"))})}),s(".track_container").on("click",".inst",function(){s("#inst_menu").animate({left:0}),t=s(this).parent().parent(),a=s(this)}),s(".inst_button").click(function(){s(this).hasClass("bass_ico")?(t.removeClass().addClass("track").addClass("bass"),a.css("background-image","url(img/ico/inst_bass.png)")):s(this).hasClass("violin_ico")?(t.removeClass().addClass("track").addClass("violin"),a.css("background-image","url(img/ico/inst_violin.png)")):s(this).hasClass("piano_ico")?(t.removeClass().addClass("track").addClass("piano"),a.css("background-image","url(img/ico/inst_piano.png)")):s(this).hasClass("synth_ico")?(t.removeClass().addClass("track").addClass("synth"),a.css("background-image","url(img/ico/inst_synth.png)")):s(this).hasClass("drums_ico")&&(t.removeClass().addClass("track").addClass("drums"),t.children().children(".note").css("display","inline-block"),a.css("background-image","url(img/ico/inst_drums.png)")),s("#inst_menu").animate({left:"-600px"})}),s(".track_container").on("click",".deletetrack",function(){if(s(".track").length<2)return!0;s(this).parent().parent().remove();var t=100/s(".track").length-s(".track").length/2;s(".track").css("max-height",t+"%"),k()}),s("#addtrack").click(function(){if(s(".track").length>=maxTracks)return!0;s(".track:last").clone(!0).appendTo(".track_container"),s(".track:last").children().children().removeClass("active"),s(".track:last").children().children(".playable").css("background-color","gainsboro"),s(".track:last").children().children(".playable.black_key").css("background-color","silver");var t=100/s(".track").length-s(".track").length/2;s(".track").css("max-height",t+"%"),u()}),s("#loop").click(function(){(r=!r)?s(this).css("background-image","url(img/loop_on.png)"):s(this).css("background-image","url(img/loop.png)")}),s("#clear").click(function(){s(".active").css("background-color","gainsboro"),s(".active.black_key").css("background-color","silver"),s(".note").removeClass("active"),s("#playstop").removeClass("stopped"),s("#playstop").addClass("playing"),r&&s("#loop").trigger("click"),s(this).reinitialize()}),s("#tostart").click(function(){s(".active").css("background-color","#4b86b4"),l=0}),s("#playstop").click(function(){s(this).hasClass("playing")?(s(this).toggleClass("playing stopped"),s(this).pauseIt()):s(this).hasClass("stopped")&&(s(this).toggleClass("playing stopped"),s(this).playIt()),s(this).css("background-image","url("+o+")")}),s.fn.reinitialize=function(){s(".active").css("background-color","#4b86b4"),r?l=1:(l=0,s("#playstop").trigger("click"))},s.fn.pauseIt=function(){clearInterval(n),o="img/play.png",h=[]},s.fn.playIt=function(){var t=s(".col").length/s(".track").length;n=setInterval(function(){s(this).playCol(t)},3e4/i),o="img/stop.png"},s.fn.playCol=function(t){++l>t&&s(this).reinitialize(),l<=t&&s(".track").each(function(){h=instruments[s(this).attr("class").split(" ")[1]],s(":nth-child("+(l+2)+")",this).children().each(function(){s(this).hasClass("active")&&(h.play(s(this).attr("class").split(" ")[0]),s(this).css("background-color","#B24444"))})})}});